<div class="events-container">
    <app-sk-sidebar></app-sk-sidebar>
    <div class="events-content">
        <div class="page-header">
            <div>
                <h1>Events</h1>
                <p class="page-subtitle">Create and manage all upcoming events</p>
            </div>
            <button 
                (click)="toggleForm()"
                class="add-button"
            >
                {{ showForm ? '‚úï Cancel' : '+ Add Event' }}
            </button>
        </div>

        <!-- Events List -->
        <div *ngIf="!showForm">
            <!-- Loading State -->
            <div *ngIf="eventsLoading" class="loading-state">Loading events...</div>

            <!-- Empty State -->
            <div *ngIf="!eventsLoading && events.length === 0" class="empty-state">
                No events found. Click "Add Event" to create one.
            </div>

            <!-- Search Toolbar -->
            <div *ngIf="!eventsLoading && events.length > 0" class="toolbar">
                <div class="search-input">
                    <input 
                        type="text" 
                        [(ngModel)]="searchTerm" 
                        (input)="onSearchChange()" 
                        placeholder="Search events by title, description, or location..."
                    />
                </div>
                <div class="export-buttons">
                    <button class="export-csv" (click)="exportToCSV()" title="Export filtered events to CSV">üì• CSV</button>
                    <button class="export-pdf" (click)="exportToPDF()" title="Export filtered events to PDF">üìÑ PDF</button>
                </div>
            </div>

            <!-- Sort Options -->
            <div class="sort-options" *ngIf="filteredEvents.length > 0">
                <span class="sort-label">Sort by:</span>
                <button 
                    (click)="onSort('title')" 
                    [class.active]="sortColumn === 'title'"
                    class="sort-btn"
                    title="Sort by title"
                >
                    Title <span *ngIf="sortColumn === 'title'">{{ sortDirection === 'asc' ? '‚ñ≤' : '‚ñº' }}</span>
                </button>
                <button 
                    (click)="onSort('eventDate')" 
                    [class.active]="sortColumn === 'eventDate'"
                    class="sort-btn"
                    title="Sort by date"
                >
                    Date <span *ngIf="sortColumn === 'eventDate'">{{ sortDirection === 'asc' ? '‚ñ≤' : '‚ñº' }}</span>
                </button>
                <button 
                    (click)="onSort('location')" 
                    [class.active]="sortColumn === 'location'"
                    class="sort-btn"
                    title="Sort by location"
                >
                    Location <span *ngIf="sortColumn === 'location'">{{ sortDirection === 'asc' ? '‚ñ≤' : '‚ñº' }}</span>
                </button>
            </div>

            <!-- Event Cards -->
            <div class="events-grid" *ngIf="filteredEvents.length > 0">
                <div *ngFor="let event of filteredEvents" class="event-card" (click)="openEventModal(event)">
                    <div class="card-header">
                        <h2 class="event-title">{{ event.title }}</h2>
                        <div class="event-date-badge">{{ event.eventDate | date:'MMM d' }}</div>
                    </div>
                    <div class="card-body">
                        <p class="event-description">{{ event.description }}</p>
                        <div class="event-details">
                            <div class="detail-item">
                                <span class="detail-label">üìç Location:</span>
                                <span class="detail-value">{{ event.location }}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">üïê Time:</span>
                                <span class="detail-value">{{ event.eventDate | date:'short' }}</span>
                            </div>
                        </div>
                    </div>
                    <div class="card-footer">
                        <div class="status-buttons">
                            <button 
                                [class.active]="event.status === 'ongoing'"
                                class="status-btn ongoing-btn" 
                                (click)="onStatusChange(event, 'ongoing'); $event.stopPropagation()"
                                title="Mark as Ongoing"
                            >
                                üîÑ Ongoing
                            </button>
                            <button 
                                [class.active]="event.status === 'completed'"
                                class="status-btn completed-btn" 
                                (click)="onStatusChange(event, 'completed'); $event.stopPropagation()"
                                title="Mark as Completed"
                            >
                                ‚úì Completed
                            </button>
                        </div>
                        <div class="action-buttons">
                            <button class="edit-btn" (click)="onEdit(event); $event.stopPropagation()" title="Edit event">‚úé Edit</button>
                            <button class="delete-btn" (click)="onDelete(event); $event.stopPropagation()" title="Delete event">üóë Delete</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- No Search Results -->
            <div *ngIf="!eventsLoading && events.length > 0 && filteredEvents.length === 0" class="empty-state">
                No events match your search. Try adjusting your search criteria.
            </div>
        </div>

        <!-- Create Event Form -->
        <div *ngIf="showForm" class="form-section">
            <h2>{{ editingEventId ? 'Edit Event' : 'Create New Event' }}</h2>
            
            <!-- Success Message -->
            <div *ngIf="successMessage" class="success-state">
                {{ successMessage }}
            </div>

            <!-- Error Message -->
            <div *ngIf="errorMessage" class="error-state">
                {{ errorMessage }}
            </div>

            <form [formGroup]="eventForm" (ngSubmit)="onSubmit()">
            <div class="form-group">
                <label for="title">Event Title</label>
                <input 
                    type="text" 
                    id="title" 
                    formControlName="title"
                    placeholder="Enter event title"
                />
                <div *ngIf="submitted && title?.invalid" class="error-text">
                    <span *ngIf="title?.errors?.['required']">Title is required</span>
                    <span *ngIf="title?.errors?.['minlength']">Title must be at least 3 characters</span>
                </div>
            </div>

            <div class="form-group">
                <label for="description">Description</label>
                <textarea 
                    id="description" 
                    formControlName="description"
                    placeholder="Enter event description"
                    rows="5"
                ></textarea>
                <div *ngIf="submitted && description?.invalid" class="error-text">
                    <span *ngIf="description?.errors?.['required']">Description is required</span>
                </div>
            </div>

            <div class="form-group">
                <label for="event_date">Event Date & Time</label>
                <input 
                    type="datetime-local" 
                    id="event_date" 
                    formControlName="event_date"
                />
                <div *ngIf="submitted && event_date?.invalid" class="error-text">
                    <span *ngIf="event_date?.errors?.['required']">Event date is required</span>
                </div>
            </div>

            <div class="form-group">
                <label for="location">Location</label>
                <input 
                    type="text" 
                    id="location" 
                    formControlName="location"
                    placeholder="Enter event location"
                />
                <div *ngIf="submitted && location?.invalid" class="error-text">
                    <span *ngIf="location?.errors?.['required']">Location is required</span>
                    <span *ngIf="location?.errors?.['minlength']">Location must be at least 3 characters</span>
                </div>
            </div>

            <div class="form-buttons">
                <button 
                    type="submit" 
                    [disabled]="loading"
                    class="btn-primary"
                >
                    {{ loading ? (editingEventId ? 'Updating...' : 'Creating...') : (editingEventId ? 'Update Event' : 'Create Event') }}
                </button>
                <button 
                    type="button" 
                    (click)="toggleForm()"
                    [disabled]="loading"
                    class="btn-secondary"
                >
                    Cancel
                </button>
            </div>
            </form>
        </div>

        <!-- Event Detail Modal -->
        <div class="modal-overlay" *ngIf="showEventModal" (click)="closeEventModal()">
            <div class="modal-content" (click)="$event.stopPropagation()">
                <div class="modal-header">
                    <h2>Event Details</h2>
                    <button class="close-btn" (click)="closeEventModal()" title="Close modal">&times;</button>
                </div>
                <div class="modal-body" *ngIf="selectedEvent">
                    <div class="detail-section">
                        <h3>{{ selectedEvent.title }}</h3>
                        <div class="status-badge" 
                            [class.status-waiting]="selectedEvent.status === 'waiting'"
                            [class.status-ongoing]="selectedEvent.status === 'ongoing'"
                            [class.status-completed]="selectedEvent.status === 'completed'"
                            [class.status-deleted]="selectedEvent.status === 'deleted'">
                            {{ selectedEvent.status | uppercase }}
                        </div>
                    </div>
                    
                    <div class="detail-section">
                        <label>Description</label>
                        <p class="description-text">{{ selectedEvent.description }}</p>
                    </div>
                    
                    <div class="detail-row">
                        <div class="detail-section">
                            <label>üìç Location</label>
                            <p>{{ selectedEvent.location }}</p>
                        </div>
                        <div class="detail-section">
                            <label>üïê Date & Time</label>
                            <p>{{ selectedEvent.eventDate | date:'full' }}</p>
                        </div>
                    </div>

                    <div class="detail-section">
                        <label>üë§ Created by Admin ID</label>
                        <p>{{ selectedEvent.createdByAdminId }}</p>
                    </div>

                    <div class="detail-row">
                        <div class="detail-section">
                            <label>üìÖ Created</label>
                            <p>{{ selectedEvent.createdAt | date:'medium' }}</p>
                        </div>
                        <div class="detail-section">
                            <label>‚úèÔ∏è Updated</label>
                            <p>{{ selectedEvent.updatedAt | date:'medium' }}</p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn-primary" (click)="closeEventModal()">Close</button>
                </div>
            </div>
        </div>
    </div>
</div>