<div class="events-container">
    <app-sk-sidebar></app-sk-sidebar>
    <div class="events-content">
        <div class="page-header">
            <div>
                <h1>Events</h1>
                <p class="page-subtitle">Create and manage all upcoming events</p>
            </div>
            <button 
                (click)="toggleForm()"
                class="add-button"
            >
                {{ showForm ? 'âœ• Cancel' : '+ Add Event' }}
            </button>
        </div>

        <!-- Events List -->
        <div *ngIf="!showForm">
            <!-- Loading State -->
            <div *ngIf="eventsLoading" class="loading-state">Loading events...</div>

            <!-- Empty State -->
            <div *ngIf="!eventsLoading && events.length === 0" class="empty-state">
                No events found. Click "Add Event" to create one.
            </div>

            <!-- Search Toolbar -->
            <div *ngIf="!eventsLoading && events.length > 0" class="toolbar">
                <div class="search-input">
                    <input 
                        type="text" 
                        [(ngModel)]="searchTerm" 
                        (input)="onSearchChange()" 
                        placeholder="Search events by title, description, or location..."
                    />
                </div>
                <div class="export-buttons">
                    <button class="export-csv" (click)="exportToCSV()" title="Export filtered events to CSV">ðŸ“¥ CSV</button>
                    <button class="export-pdf" (click)="exportToPDF()" title="Export filtered events to PDF">ðŸ“„ PDF</button>
                </div>
            </div>

            <!-- Events Table -->
            <div *ngIf="!eventsLoading && filteredEvents.length > 0" class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th (click)="onSort('title')" title="Click to sort">
                                Title <span *ngIf="sortColumn === 'title'">{{ sortDirection === 'asc' ? 'â–²' : 'â–¼' }}</span>
                            </th>
                            <th (click)="onSort('description')" title="Click to sort">
                                Description <span *ngIf="sortColumn === 'description'">{{ sortDirection === 'asc' ? 'â–²' : 'â–¼' }}</span>
                            </th>
                            <th (click)="onSort('eventDate')" title="Click to sort">
                                Date & Time <span *ngIf="sortColumn === 'eventDate'">{{ sortDirection === 'asc' ? 'â–²' : 'â–¼' }}</span>
                            </th>
                            <th (click)="onSort('location')" title="Click to sort">
                                Location <span *ngIf="sortColumn === 'location'">{{ sortDirection === 'asc' ? 'â–²' : 'â–¼' }}</span>
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let event of filteredEvents">
                            <td title="{{ event.title }}">{{ event.title }}</td>
                            <td title="{{ event.description }}">{{ event.description }}</td>
                            <td>{{ event.eventDate | date: 'short' }}</td>
                            <td>{{ event.location }}</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- No Search Results -->
            <div *ngIf="!eventsLoading && events.length > 0 && filteredEvents.length === 0" class="empty-state">
                No events match your search. Try adjusting your search criteria.
            </div>
        </div>

        <!-- Create Event Form -->
        <div *ngIf="showForm" class="form-section">
            <h2>Create New Event</h2>
            
            <!-- Success Message -->
            <div *ngIf="successMessage" class="success-state">
                {{ successMessage }}
            </div>

            <!-- Error Message -->
            <div *ngIf="errorMessage" class="error-state">
                {{ errorMessage }}
            </div>

            <form [formGroup]="eventForm" (ngSubmit)="onSubmit()">
            <div class="form-group">
                <label for="title">Event Title</label>
                <input 
                    type="text" 
                    id="title" 
                    formControlName="title"
                    placeholder="Enter event title"
                />
                <div *ngIf="submitted && title?.invalid" class="error-text">
                    <span *ngIf="title?.errors?.['required']">Title is required</span>
                    <span *ngIf="title?.errors?.['minlength']">Title must be at least 3 characters</span>
                </div>
            </div>

            <div class="form-group">
                <label for="description">Description</label>
                <textarea 
                    id="description" 
                    formControlName="description"
                    placeholder="Enter event description"
                    rows="5"
                ></textarea>
                <div *ngIf="submitted && description?.invalid" class="error-text">
                    <span *ngIf="description?.errors?.['required']">Description is required</span>
                </div>
            </div>

            <div class="form-group">
                <label for="event_date">Event Date & Time</label>
                <input 
                    type="datetime-local" 
                    id="event_date" 
                    formControlName="event_date"
                />
                <div *ngIf="submitted && event_date?.invalid" class="error-text">
                    <span *ngIf="event_date?.errors?.['required']">Event date is required</span>
                </div>
            </div>

            <div class="form-group">
                <label for="location">Location</label>
                <input 
                    type="text" 
                    id="location" 
                    formControlName="location"
                    placeholder="Enter event location"
                />
                <div *ngIf="submitted && location?.invalid" class="error-text">
                    <span *ngIf="location?.errors?.['required']">Location is required</span>
                    <span *ngIf="location?.errors?.['minlength']">Location must be at least 3 characters</span>
                </div>
            </div>

            <div class="form-buttons">
                <button 
                    type="submit" 
                    [disabled]="loading"
                    class="btn-primary"
                >
                    {{ loading ? 'Creating...' : 'Create Event' }}
                </button>
                <button 
                    type="button" 
                    (click)="resetForm()"
                    [disabled]="loading"
                    class="btn-secondary"
                >
                    Reset
                </button>
            </div>
            </form>
        </div>
    </div>
</div>