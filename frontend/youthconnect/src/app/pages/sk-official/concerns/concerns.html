
<div class="concerns-container">
    <app-sk-sidebar></app-sk-sidebar>
    <div class="concerns-content">
        <h1>Youth Concerns</h1>
        <p class="page-subtitle">Manage and track all youth member concerns</p>

        <!-- Loading State -->
        <div *ngIf="loading" class="loading-state">Loading concerns...</div>

        <!-- Error State -->
        <div *ngIf="errorMessage" class="error-state">{{ errorMessage }}</div>

        <!-- Main Content -->
        <div *ngIf="!loading && concerns.length > 0">
            <!-- Search, Filter Toolbar -->
            <div class="toolbar">
                <div class="search-input">
                    <input 
                        type="text" 
                        [(ngModel)]="searchTerm" 
                        (input)="onSearchChange()" 
                        placeholder="Search concerns by title, type, or description..."
                    />
                </div>
                <div class="filter-group">
                    <select [(ngModel)]="filterType" (ngModelChange)="onTypeFilterChange($event)" class="filter-select">
                        <option value="">All Types</option>
                        <option *ngFor="let type of getTypeOptions()" [value]="type">{{ type }}</option>
                    </select>
                    <select [(ngModel)]="filterStatus" (ngModelChange)="onStatusFilterChange($event)" class="filter-select">
                        <option value="">All Status</option>
                        <option *ngFor="let status of getStatusOptions()" [value]="status">{{ status }}</option>
                    </select>
                </div>
            </div>

            <!-- Sort Options -->
            <div class="sort-options" *ngIf="filteredConcerns.length > 0">
                <span class="sort-label">Sort by:</span>
                <button 
                    (click)="onSort('title')" 
                    [class.active]="sortColumn === 'title'"
                    class="sort-btn"
                    title="Sort by title"
                >
                    Title <span *ngIf="sortColumn === 'title'">{{ sortDirection === 'asc' ? '‚ñ≤' : '‚ñº' }}</span>
                </button>
                <button 
                    (click)="onSort('status')" 
                    [class.active]="sortColumn === 'status'"
                    class="sort-btn"
                    title="Sort by status"
                >
                    Status <span *ngIf="sortColumn === 'status'">{{ sortDirection === 'asc' ? '‚ñ≤' : '‚ñº' }}</span>
                </button>
                <button 
                    (click)="onSort('createdAt')" 
                    [class.active]="sortColumn === 'createdAt'"
                    class="sort-btn"
                    title="Sort by date"
                >
                    Created <span *ngIf="sortColumn === 'createdAt'">{{ sortDirection === 'asc' ? '‚ñ≤' : '‚ñº' }}</span>
                </button>
            </div>

            <!-- Concerns Cards Grid -->
            <div class="concerns-grid" *ngIf="paginatedConcerns.length > 0">
                <div *ngFor="let concern of paginatedConcerns" class="concern-card">
                    <div class="card-header">
                        <h2 class="concern-title">{{ concern.title }}</h2>
                        <span 
                            class="status-badge"
                            [ngClass]="{
                                'status-open': concern.status === 'Open',
                                'status-closed': concern.status === 'Closed',
                                'status-in-progress': concern.status === 'In Progress',
                                'status-pending': concern.status === 'Pending'
                            }"
                        >
                            {{ concern.status }}
                        </span>
                    </div>
                    <div class="card-body" (click)="openDetailModal(concern)">
                        <p class="concern-description">{{ concern.description }}</p>
                        <div class="concern-details">
                            <div class="detail-item">
                                <span class="detail-label">üìã Type:</span>
                                <span class="detail-value">{{ concern.typeOfConcern }}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">üìÖ Created:</span>
                                <span class="detail-value">{{ concern.createdAt | date:'short' }}</span>
                            </div>
                        </div>
                    </div>
                    <div class="card-footer">
                        <button 
                            class="resolve-btn"
                            (click)="onResolveConcern(concern)"
                            [disabled]="resolvingId === concern.concernId || concern.status === 'Resolved'"
                            [title]="concern.status === 'Resolved' ? 'Already resolved' : resolvingId === concern.concernId ? 'Resolving...' : 'Mark as resolved'"
                        >
                            {{ concern.status === 'Resolved' ? '‚úì Resolved' : resolvingId === concern.concernId ? '‚è≥ Resolving...' : '‚úì Mark as Resolved' }}
                        </button>
                        <button 
                            class="delete-btn"
                            (click)="onDelete(concern)"
                            [disabled]="deletingId === concern.concernId"
                            [title]="deletingId === concern.concernId ? 'Deleting...' : 'Delete this concern'"
                        >
                            {{ deletingId === concern.concernId ? '‚è≥ Deleting...' : 'üóëÔ∏è Delete' }}
                        </button>
                    </div>
                </div>
            </div>

            <!-- Pagination -->
            <div class="pagination-container" *ngIf="totalPages > 1">
                <div class="pagination-info">
                    Showing {{ (currentPage - 1) * itemsPerPage + 1 }} to {{ Math.min(currentPage * itemsPerPage, filteredConcerns.length) }} of {{ filteredConcerns.length }} concerns
                </div>
                <div class="pagination-controls">
                    <button 
                        class="pagination-btn" 
                        (click)="onPageChange(currentPage - 1)" 
                        [disabled]="currentPage === 1"
                        title="Previous page"
                    >
                        ‚óÄ Previous
                    </button>
                    <div class="page-buttons">
                        <button 
                            *ngIf="getPageNumbers()[0] > 1"
                            class="pagination-btn"
                            (click)="onPageChange(1)"
                            title="Go to first page"
                        >
                            1
                        </button>
                        <span *ngIf="getPageNumbers()[0] > 2" class="ellipsis">...</span>
                        <button 
                            *ngFor="let page of getPageNumbers()"
                            class="pagination-btn"
                            [class.active]="page === currentPage"
                            (click)="onPageChange(page)"
                            [title]="'Go to page ' + page"
                        >
                            {{ page }}
                        </button>
                        <span *ngIf="getPageNumbers()[getPageNumbers().length - 1] < totalPages - 1" class="ellipsis">...</span>
                        <button 
                            *ngIf="getPageNumbers()[getPageNumbers().length - 1] < totalPages"
                            class="pagination-btn"
                            (click)="onPageChange(totalPages)"
                            [title]="'Go to last page'"
                        >
                            {{ totalPages }}
                        </button>
                    </div>
                    <button 
                        class="pagination-btn" 
                        (click)="onPageChange(currentPage + 1)" 
                        [disabled]="currentPage === totalPages"
                        title="Next page"
                    >
                        Next ‚ñ∂
                    </button>
                </div>
            </div>

            <!-- Empty Filter Results -->
            <div *ngIf="filteredConcerns.length === 0" class="empty-state">
                <p>No concerns match your search criteria. Try adjusting your filters.</p>
            </div>
        </div>

        <!-- No Data State -->
        <div *ngIf="!loading && concerns.length === 0" class="empty-state">
            <p>No concerns found. Youth members will be able to submit concerns here.</p>
        </div>
    </div>
</div>

<!-- Concern Detail Modal -->
<div class="modal-overlay" *ngIf="showDetailModal && selectedConcern" (click)="closeDetailModal()">
    <div class="modal-content detail-modal" (click)="$event.stopPropagation()">
        <div class="modal-header">
            <h2>{{ selectedConcern.title }}</h2>
            <button class="close-btn" (click)="closeDetailModal()">&times;</button>
        </div>
        
        <div class="modal-body">
            <div class="detail-section">
                <div class="status-section">
                    <span 
                        class="status-badge large"
                        [ngClass]="{
                            'status-open': selectedConcern.status === 'Open',
                            'status-closed': selectedConcern.status === 'Closed',
                            'status-in-progress': selectedConcern.status === 'In Progress',
                            'status-pending': selectedConcern.status === 'Pending'
                        }"
                    >
                        {{ selectedConcern.status }}
                    </span>
                </div>

                <div class="detail-row">
                    <label class="detail-label">Type of Concern:</label>
                    <p class="detail-text">{{ selectedConcern.typeOfConcern }}</p>
                </div>

                <div class="detail-row">
                    <label class="detail-label">Description:</label>
                    <p class="detail-text description-text">{{ selectedConcern.description }}</p>
                </div>

                <div class="detail-row">
                    <label class="detail-label">Youth Member:</label>
                    <p class="detail-text">{{ selectedConcern.youthId }}</p>
                </div>

                <div class="detail-row">
                    <label class="detail-label">Created Date:</label>
                    <p class="detail-text">{{ selectedConcern.createdAt | date:'medium' }}</p>
                </div>

                <div class="detail-row" *ngIf="selectedConcern.updatedAt">
                    <label class="detail-label">Last Updated:</label>
                    <p class="detail-text">{{ selectedConcern.updatedAt | date:'medium' }}</p>
                </div>
            </div>
        </div>

        <div class="modal-footer">
            <button class="btn-close" (click)="closeDetailModal()">Close</button>
        </div>
    </div>
</div>