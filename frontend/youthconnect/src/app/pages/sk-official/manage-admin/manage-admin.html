<div class="admin-management-wrapper">
  <app-sk-sidebar></app-sk-sidebar>

  <div class="admin-management-container">
    <div class="header">
      <h1>Administrator Management</h1>
      <button class="btn-primary" (click)="openForm()" [disabled]="loading">
        + Add New Admin
      </button>
    </div>

    @if (error) {
      <div class="alert alert-error">
        {{ error }}
      </div>
    }

    @if (success) {
      <div class="alert alert-success">
        {{ success }}
      </div>
    }

    <!-- Add/Edit Form Modal -->
    @if (showForm) {
      <div class="modal-overlay" (click)="closeForm()">
        <div class="modal-content" (click)="$event.stopPropagation()">
          <div class="modal-header">
            <h2>{{ editingId ? 'Edit Admin' : 'Add New Admin' }}</h2>
            <button class="btn-close" (click)="closeForm()">Ã—</button>
          </div>

          <form class="admin-form" (ngSubmit)="submitForm()">
            <div class="form-group">
              <label>First Name *</label>
              <input
                type="text"
                [(ngModel)]="formData.firstName"
                name="firstName"
                placeholder="Enter first name"
                required
              />
            </div>

            <div class="form-group">
              <label>Last Name *</label>
              <input
                type="text"
                [(ngModel)]="formData.lastName"
                name="lastName"
                placeholder="Enter last name"
                required
              />
            </div>

            <div class="form-group">
              <label>Email *</label>
              <input
                type="email"
                [(ngModel)]="formData.email"
                name="email"
                placeholder="Enter email"
                required
              />
            </div>

            <div class="form-group">
              <label>Password *</label>
              <input
                type="password"
                [(ngModel)]="formData.passwordHash"
                name="passwordHash"
                placeholder="Enter password"
                required
              />
            </div>

            <div class="form-actions">
              <button type="button" class="btn-secondary" (click)="closeForm()">
                Cancel
              </button>
              <button type="submit" class="btn-primary" [disabled]="loading">
                {{ loading ? 'Saving...' : 'Save' }}
              </button>
            </div>
          </form>
        </div>
      </div>
    }

    <!-- Admins Table -->
    <div class="table-wrapper">
      @if (loading && admins.length === 0) {
        <div class="loading">Loading admins...</div>
      } @else if (admins.length === 0) {
        <div class="no-data">No administrators found</div>
      } @else {
        <table class="admins-table">
          <thead>
            <tr>
              <th>ID</th>
              <th>First Name</th>
              <th>Last Name</th>
              <th>Email</th>
              <th>Status</th>
              <th>Created</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            @for (admin of admins; track admin.adminId) {
              @if (isEditing(admin.adminId)) {
                <!-- Inline Edit Row -->
                <tr class="edit-row">
                  <td>{{ admin.adminId }}</td>
                  <td>
                    <input
                      type="text"
                      [(ngModel)]="editingData[admin.adminId || 0].firstName"
                      class="inline-input"
                    />
                  </td>
                  <td>
                    <input
                      type="text"
                      [(ngModel)]="editingData[admin.adminId || 0].lastName"
                      class="inline-input"
                    />
                  </td>
                  <td>
                    <input
                      type="email"
                      [(ngModel)]="editingData[admin.adminId || 0].email"
                      class="inline-input"
                    />
                  </td>
                  <td>
                    <span
                      class="status"
                      [class.active]="editingData[admin.adminId || 0].isActive"
                    >
                      {{ editingData[admin.adminId || 0].isActive ? 'Active' : 'Inactive' }}
                    </span>
                  </td>
                  <td>{{ admin.createdAt | date: 'short' }}</td>
                  <td class="actions">
                    <button
                      class="btn-save"
                      (click)="saveInlineEdit(admin.adminId)"
                      [disabled]="loading"
                    >
                      Save
                    </button>
                    <button
                      class="btn-cancel"
                      (click)="cancelInlineEdit()"
                      [disabled]="loading"
                    >
                      Cancel
                    </button>
                  </td>
                </tr>
              } @else {
                <!-- Normal Row -->
                <tr>
                  <td>{{ admin.adminId }}</td>
                  <td>{{ admin.firstName }}</td>
                  <td>{{ admin.lastName }}</td>
                  <td>{{ admin.email }}</td>
                  <td>
                    <span class="status" [class.active]="admin.isActive">
                      {{ admin.isActive ? 'Active' : 'Inactive' }}
                    </span>
                  </td>
                  <td>{{ admin.createdAt | date: 'short' }}</td>
                  <td class="actions">
                    <button
                      class="btn-edit"
                      (click)="startInlineEdit(admin)"
                      [disabled]="loading"
                      title="Edit inline"
                    >
                      âœŽ
                    </button>
                    <button
                      class="btn-deactivate"
                      (click)="deactivateAdmin(admin.adminId)"
                      [disabled]="loading || !admin.isActive"
                      title="Deactivate"
                    >
                      âŠ˜
                    </button>
                    <button
                      class="btn-delete"
                      (click)="deleteAdmin(admin.adminId)"
                      [disabled]="loading"
                      title="Delete"
                    >
                      ðŸ—‘
                    </button>
                  </td>
                </tr>
              }
            }
          </tbody>
        </table>
      }
    </div>
  </div>
</div>
