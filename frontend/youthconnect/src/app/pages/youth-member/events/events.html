<div class="events-container">
    <app-youth-sidebar></app-youth-sidebar>
    <div class="events-content">
        <h1>Upcoming Events</h1>
        <p class="page-subtitle">Discover and explore all events created by administrators</p>

        <!-- Loading State -->
        <div *ngIf="loading" class="loading-state">Loading events...</div>

        <!-- Error State -->
        <div *ngIf="errorMessage" class="error-state">{{ errorMessage }}</div>

        <!-- Main Content -->
        <div *ngIf="!loading && events.length > 0">
            <!-- Search Toolbar -->
            <div class="toolbar">
                <div class="search-input">
                    <input 
                        type="text" 
                        [(ngModel)]="searchTerm" 
                        (input)="onSearchChange()" 
                        placeholder="Search events by title, description, or location..."
                    />
                </div>
            </div>

            <!-- Sort Options -->
            <div class="sort-options" *ngIf="filteredEvents.length > 0">
                <span class="sort-label">Sort by:</span>
                <button 
                    (click)="onSort('title')" 
                    [class.active]="sortColumn === 'title'"
                    class="sort-btn"
                    title="Sort by title"
                >
                    Title <span *ngIf="sortColumn === 'title'">{{ sortDirection === 'asc' ? '‚ñ≤' : '‚ñº' }}</span>
                </button>
                <button 
                    (click)="onSort('eventDate')" 
                    [class.active]="sortColumn === 'eventDate'"
                    class="sort-btn"
                    title="Sort by date"
                >
                    Date <span *ngIf="sortColumn === 'eventDate'">{{ sortDirection === 'asc' ? '‚ñ≤' : '‚ñº' }}</span>
                </button>
                <button 
                    (click)="onSort('location')" 
                    [class.active]="sortColumn === 'location'"
                    class="sort-btn"
                    title="Sort by location"
                >
                    Location <span *ngIf="sortColumn === 'location'">{{ sortDirection === 'asc' ? '‚ñ≤' : '‚ñº' }}</span>
                </button>
            </div>

            <!-- Event Cards -->
            <div class="events-grid" *ngIf="filteredEvents.length > 0">
                <div *ngFor="let event of paginatedEvents" class="event-card">
                    <div class="card-header">
                        <h2 class="event-title">{{ event.title }}</h2>
                        <div class="event-date-badge">{{ event.eventDate | date:'MMM d' }}</div>
                    </div>
                    <div class="card-body">
                        <p class="event-description">{{ event.description }}</p>
                        <div class="event-details">
                            <div class="detail-item">
                                <span class="detail-label">üìç Location:</span>
                                <span class="detail-value">{{ event.location }}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">üïê Time:</span>
                                <span class="detail-value">{{ event.eventDate | date:'short' }}</span>
                            </div>
                            <div class="detail-item" *ngIf="event.status">
                                <span class="detail-label">Status:</span>
                                <span class="status-badge" 
                                    [class.status-waiting]="event.status === 'waiting'"
                                    [class.status-ongoing]="event.status === 'ongoing'" 
                                    [class.status-completed]="event.status === 'completed'">
                                    {{ getStatusDisplay(event.status) }}
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="card-footer">
                        <button 
                            *ngIf="!isUserRegistered(event.eventId)"
                            class="register-btn" 
                            (click)="openRegistrationModal(event)"
                        >
                            Register Now
                        </button>
                        <button 
                            *ngIf="isUserRegistered(event.eventId)"
                            class="registered-btn"
                            disabled
                            title="You are already registered for this event"
                        >
                            ‚úì Registered
                        </button>
                    </div>
                </div>
            </div>

            <!-- Empty State -->
            <div *ngIf="filteredEvents.length === 0 && !loading" class="empty-state">
                No events found matching your search.
            </div>

            <!-- Pagination -->
            <div class="pagination-container" *ngIf="totalPages > 1">
                <div class="pagination-info">
                    Showing {{ (currentPage - 1) * itemsPerPage + 1 }} to {{ Math.min(currentPage * itemsPerPage, filteredEvents.length) }} of {{ filteredEvents.length }} events
                </div>
                <div class="pagination-controls">
                    <button 
                        class="pagination-btn" 
                        (click)="onPageChange(currentPage - 1)" 
                        [disabled]="currentPage === 1"
                        title="Previous page"
                    >
                        ‚Üê Previous
                    </button>
                    <div class="page-buttons">
                        <button 
                            *ngIf="getPageNumbers()[0] > 1" 
                            class="pagination-btn" 
                            (click)="onPageChange(1)"
                            title="Go to first page"
                        >
                            1
                        </button>
                        <span *ngIf="getPageNumbers()[0] > 2" class="ellipsis">...</span>
                        <button 
                            *ngFor="let page of getPageNumbers()"
                            (click)="onPageChange(page)"
                            [class.active]="currentPage === page"
                            class="pagination-btn"
                            [title]="'Go to page ' + page"
                        >
                            {{ page }}
                        </button>
                        <span *ngIf="getPageNumbers()[getPageNumbers().length - 1] < totalPages - 1" class="ellipsis">...</span>
                        <button 
                            *ngIf="getPageNumbers()[getPageNumbers().length - 1] < totalPages" 
                            class="pagination-btn" 
                            (click)="onPageChange(totalPages)"
                            [title]="'Go to page ' + totalPages"
                        >
                            {{ totalPages }}
                        </button>
                    </div>
                    <button 
                        class="pagination-btn" 
                        (click)="onPageChange(currentPage + 1)" 
                        [disabled]="currentPage === totalPages"
                        title="Next page"
                    >
                        Next ‚Üí
                    </button>
                </div>
            </div>
        </div>

        <!-- Empty State (No Events) -->
        <div *ngIf="!loading && events.length === 0" class="empty-state">
            No events available at this time.
        </div>
    </div>
</div>

<!-- Registration Modal -->
<div class="modal-overlay" *ngIf="showRegistrationModal" (click)="closeRegistrationModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
            <h2>Register for Event</h2>
            <button class="close-btn" (click)="closeRegistrationModal()">&times;</button>
        </div>
        
        <div class="modal-body" *ngIf="selectedEvent">
            <!-- Event Details -->
            <div class="event-summary">
                <h3>{{ selectedEvent.title }}</h3>
                <p class="event-date">üìÖ {{ selectedEvent.eventDate | date:'full' }}</p>
                <p class="event-location">üìç {{ selectedEvent.location }}</p>
                <p class="event-description">{{ selectedEvent.description }}</p>
            </div>

            <!-- Registration Form -->
            <div class="registration-form">
                <p class="form-instruction">Please confirm your registration for this event.</p>
                
                <!-- Status Messages -->
                <div *ngIf="registrationMessage" [class.success-message]="registrationMessageType === 'success'" [class.error-message]="registrationMessageType === 'error'" class="status-message">
                    {{ registrationMessage }}
                </div>

                <!-- Action Buttons -->
                <div class="modal-footer">
                    <button class="cancel-btn" (click)="closeRegistrationModal()" [disabled]="isSubmitting">
                        Cancel
                    </button>
                    <button class="confirm-btn" (click)="registerForEvent()" [disabled]="isSubmitting">
                        {{ isSubmitting ? 'Registering...' : 'Confirm Registration' }}
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>